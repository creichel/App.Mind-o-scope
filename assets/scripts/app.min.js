function buildMindmap(e,t){"use strict";function n(){return window.innerWidth>window.innerHeight?window.innerHeight-50:window.innerWidth}function s(e){var t=0;return e.children&&e.children.forEach(function(e){var n=s(e);n>t&&(t=n)}),1+t}function l(e){if(e.children){for(var t=0;t<e.children.length;t++){var n=e.children[t];l(n)}1===e.children.length&&e.children.push({name:"placeholder",children:[{name:"placeholder",children:[]}]})}}function i(e){for(var t=e.length-1;t>=0;t--){var n=e[t];"placeholder"===n.name?e.splice(t,1):n.children&&i(n.children)}}function c(e){function t(e,n){if(e.children)for(var s=0;s<e.children.length;s++)e.children[s].x+=n,t(e.children[s],n)}for(var n=0;n<e.length;n++){var s=e[n];if(s.children&&1===s.children.length){var l=s.x-s.children[0].x;s.children[0].x+=l,t(s.children[0],l)}}}function o(e){for(var t=e[0].x,n=e[0].y,s=0;s<e.length;s++){var l=e[s];l.x-=t,l.y-=n}}function r(e,t){var n=window.location.href;if(n.indexOf(e+"=")>=0){var s=n.substring(0,n.indexOf(e)),l=n.substring(n.indexOf(e));l=l.substring(l.indexOf("=")+1),l=l.indexOf("&")>=0?l.substring(l.indexOf("&")):"",n=s+e+"="+t+l}else n+=n.indexOf("?")<0?"?"+e+"="+t:"&"+e+"="+t;d(n)}function d(e){history.pushState("",V,e),document.getElementById("shareURL").value=e,document.title=V}function a(e){var t;t=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),t.onreadystatechange=function(){4==t.readyState&&200==t.status&&(document.getElementById("A1").innerHTML=t.status,document.getElementById("A2").innerHTML=t.statusText,document.getElementById("A3").innerHTML=t.responseText)},t.open("post",e,!0),t.send()}function u(e){var t=0;return N.selectAll("circle").data(e).enter().append("circle").attr("class",function(e){var t="node"+(e.parent?e.children?"":" leaf":" root");return t+=e.depth%2===0?" even":" odd"}).attr("r",function(e){return e.r+7}).style("fill",function(e){if(1==e.depth&&t++,e.children){if(e.depth%2!=0)return Z(t);var n=d3.hsl(Z(t)),s=d3.hsl("hsl("+n.h+","+100*n.s*1.09+"%,"+100*n.l*1.2+"%)");return s}return null})}function f(e,t){var n=N.selectAll("g.label").data(e).enter().append("g").attr("class","label").attr("transform","translate(0,"+j+")").style("opacity",function(e){return e.parent===t?1:0}).style("display",function(e){return e.parent===t?"inline":"none"});return n.append("text").text(function(e){return e.name}),n}function h(e){function t(e){var t=d3.layout.tree(),s=15,l=0,i=n.append("ul").classed("treelist",!0),c=t.nodes(e),o=i.selectAll("li.item").data(c),r=o.enter().append("li").attr("class",function(e){var t="item"+(e.parent?e.children?"":" leaf":" root");return t+=e.depth%2===0?" even":" odd"}).attr("id",function(e,t){return"id"+t}).style("opacity",1).style("background-color",function(e){return G(e.depth)}).append("span").attr("class","value").style("padding-left",function(e){return 20+e.depth*s+"px"}).html(function(e){return e.name}),l=0,d=d3.selectAll("li.item").filter(function(e,t){return 0==t}).node().getBoundingClientRect().top;c.forEach(function(e,t){var n=d3.selectAll("li.item").filter(function(e,n){return n==t}).node().getBoundingClientRect().top;e.x=n-d,e.y=e.depth*s,1==e.depth&&l++,e.value=l}),r.append("span").attr("class","point").style("padding-left",function(e){return e.depth*s+"px"}).style("color",function(e){return Z(e.value)});var a=n.node().getBoundingClientRect().width,u=n.node().getBoundingClientRect().height,f=0,h=0,p={top:20,right:10,bottom:10,left:15},v=d3.svg.line().x(function(e){return e.x}).y(function(e){return e.y}).interpolate("step"),g=n.append("svg").attr("width",a-p.left-p.right+"px").attr("height",u+"px").append("g").attr("transform","translate("+p.left+","+p.top+")"),y=g.selectAll("path.link").data(t.links(c)).enter().insert("path","g").attr("class","link").attr("stroke",function(e){return Z(e.target.value)}).attr("d",function(e,t){return v([{y:e.source.x,x:e.source.y},{y:e.target.x,x:e.target.y}])});return o}var n=d3.select("#treelist");return t(e)}function p(e){var n=ee;if(ee=e,M(e),ee!==n){null==e.parent?P.attr("disabled","true"):P.attr("disabled",null);var s=d3.transition().duration(d3.event.altKey?10*t:t).tween("zoom",function(){var e=d3.interpolateZoom(ne,[ee.x,ee.y,2*ee.r]);return function(t){v(e(t))}});s.selectAll("g.label").filter(function(e){return e.parent===ee||"inline"===this.style.display}).style("opacity",function(e){return e.parent===ee?1:0}).each("start",function(e){e.parent===ee&&(this.style.display="inline")}).each("end",function(e){e.parent!==ee&&(this.style.display="none")})}}function v(e){ie.classed("active",!1).filter(function(e){return ee==e}).classed("active",!0),ce.classed("active",!1).filter(function(e){return ee==e}).classed("active",!0);var t=H/e[2];ne=e,ce.attr("transform",function(n){return"translate("+(n.x-e[0])*t+","+(n.y-e[1])*t+")"}),se.attr("r",function(e){return e.r*t})}function g(){S.classed("show",!S.classed("show")),0==Y?(R(),Y=!0,setTimeout(function(){d3.select("#search").node().focus()},300)):(Y=!1,w(),d3.select("#search").node().blur())}function y(){S.classed("show",!1),Y=!1,d3.select("#search").node().blur(),w()}function m(){var e="#settings",t="#openSettings";S.select(e).classed("show",!S.select(e).classed("show")),S.select(t).classed("active",!S.select(t).classed("active")),S.classed("visibleSettings",!S.classed("visibleSettings"))}function w(){var e="#settings",t="#openSettings";S.select(e).classed("show",!1),S.select(t).classed("active",!1)}function x(e){w(),ie.classed("hide",!0).filter(function(t){var n=t.name;return n.toLowerCase().indexOf(e.toLowerCase())>-1}).classed("hide",!1),ce.classed("hide",!0).filter(function(t){var n=t.name;return n.toLowerCase().indexOf(e.toLowerCase())>-1}).classed("hide",!1),""!=e?(d3.select("#treelist").select("svg").style("display","none"),d3.select("#searchterm").text(e).classed("show",!0).on("click",function(){d3.select("#searchterm").classed("show",!1),document.getElementById("search").value="",ie.classed("hide",!1),ce.classed("hide",!1),d3.select("#treelist").select("svg").style("display",null)})):(d3.select("#searchterm").classed("show",!1),d3.select("#treelist").select("svg").style("display",null))}function b(e){r("zoom",e),t=e}function k(e){r("visited",e?"y":""),d3.select("body").classed("hide-visited",e)}function E(e){r("labels",e?"y":""),d3.select("body").classed("hide-labels",e)}function C(e){r("tooltips",e?"y":""),d3.select("body").classed("hide-tooltip",e)}function A(){window.location="download.php?hash="+e}function B(){O()}function D(){a("delete.php?hash="+e),O()}function O(){d3.select(".dropzone").classed("hover",!1).classed("error",!1).classed("dropped",!1).classed("success",!1).classed("dz-processing",!1).classed("dz-complete",!1),d3.select("body").style("position","relative"),d3.select("#upload").style("display","block"),d3.select("#mindmap").style("display","none"),d3.select("#"+T).select("svg").remove(),d3.select("#treelist").select("ul").remove(),d3.select("#treelist").select("svg").remove(),y(),w(),d3.select("#searchterm").classed("show",!1)}function L(){d3.select("body").style("position","relative"),X=document.getElementById(T).offsetWidth,j=document.getElementById(T).offsetHeight,H=n(),d3.select("#"+T).select("svg").style("width",X+"px").style("height",j+"px"),d3.select(self.frameElement).style("height",H+"px"),d3.select("#"+T).select("svg").select("g").attr("transform","translate("+X/2+","+(j/2+I/2)+")"),d3.select("body").style("position","fixed")}function M(e){function t(e,n){if(null!=e.parent){e=e.parent,n.insert("span",":first-child").attr("class","divider");var s=e.depth+2>ee.depth||e.depth<2?e.name:"···";n.insert("button",":first-child").text(s).on("click",function(){y(),p(e)}).on("mouseover",function(){se.filter(function(t){return e==t}).classed("hover",!0)}).on("mouseout",function(){se.filter(function(t){return e==t}).classed("hover",!1)}),t(e,n)}}var n=d3.select("#path .content");n.html(""),n.append("span").attr("class","active").text(e.name),t(e,n)}function R(){var e=j-S.select("header").node().getBoundingClientRect().height-S.select(".searchbar").node().getBoundingClientRect().height-S.select("footer").node().getBoundingClientRect().height;S.select(".content").style("height",e+"px"),S.select(".scrollmask").style("height",e+"px")}d3.select("#upload").style("display","none"),d3.select("#mindmap").style("display","block");var I=35,z=1,H=n(),T="content",S=d3.select("#sidebar"),F=d3.select("#menubutton"),P=d3.select("#toRoot"),W="content/"+e+".json",X=document.getElementById(T).offsetWidth,j=document.getElementById(T).offsetHeight,q=1e3,V="Mind-o-scope",K=50,U=1,Z=d3.scale.ordinal().range(["#EF721F","#4E9CEE","#36D63D","#DEC815","#E076E7","#75AE29","#E8A117","#39CD68","#A886F2","#C985D6","#CA8025","#ABA414","#F46841","#A0CB1C","#50AB46","#75CE2F","#8E94E8","#33B22E","#61D350","#E58222"]),G=d3.scale.linear().domain([0,8]).range(["#FCFCFC","#D4D4D4"]).interpolate(d3.interpolateRgb),J=d3.layout.pack().padding(z).size([H-I,H-I]).value(function(e){return q*Math.pow(1/e.depth,3)}),N=d3.select("#"+T).append("svg").append("g"),Q=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(e){return e.name});N.call(Q),String.prototype.trunc=function(e,t){var n=this.length>e,s=n?this.substr(0,e-1):this;return s=t&&n?s.substr(0,s.lastIndexOf(" ")):s,n?s+"…":s};var Y=!1,_=!1,ee,te,ne,se,le,ie,ce;d3.json(W,function(t,n){if(t)throw t;ie=h(n),console.log("Depth of the Mind Map: "+s(n)),G.domain([0,s(n)]),l(n),ee=n,te=J.nodes(n),i(te),c(te),o(te),console.log("Structure:"),console.log(n),se=u(te),le=f(te,n),d3.select(window).on("resize",function(){L(),R()}),d3.select("#"+T).on("click",function(){p(n),y()}),P.on("click",function(){p(n)}),se.on("click",function(e){d3.select(this).classed("visited",!0),ee!==e&&(y(),p(e),d3.event.stopPropagation())}).on("mouseover",function(e){Q.attr("class","d3-tip animate").show(e)}).on("mouseout",function(e){Q.attr("class","d3-tip").show(e),Q.hide()}),F.on("click",function(){g()}),ie.on("click",function(e){e.children?ee!==e&&(p(e),d3.event.stopPropagation()):ee!==e.parent&&(p(e.parent),d3.event.stopPropagation())}).on("mouseover",function(e,t){ce.filter(function(e,n){return t==n}).classed("hover",!0)}).on("mouseout",function(e,t){ce.filter(function(e,n){return t==n}).classed("hover",!1)}),d3.select("#openSettings").on("click",function(){m()}),d3.select("#search").on("input",function(){p(n);var e=this.value;x(e)}),d3.selectAll("input").on("focus",function(){d3.event.preventDefault()}),d3.select("#hideVisited").on("change",function(){k(this.checked)}),d3.select("#hideLabels").on("change",function(){E(this.checked)}),d3.select("#disableTooltip").on("change",function(){C(this.checked)}),d3.select("#zoomDuration").on("mousedown touchstart",function(){d3.select("#zoomDurationOutput").classed("active",!0)}).on("mouseout touchend",function(){d3.select("#zoomDurationOutput").classed("active",!1)}).on("change",function(){b(this.value)}),d3.select("#download").on("click",function(){A()}),d3.select("#new").on("click",function(){B()}),d3.select("#delete").on("click",function(){D()}),d3.select("body").on("keydown",function(){Y||70!=d3.event.keyCode?27==d3.event.keyCode&&(d3.event.preventDefault(),g()):(d3.event.preventDefault(),g())}),L(),R(),M(n),ce=N.selectAll("circle,g.label"),k(d3.select("#hideVisited").node().checked),E(d3.select("#hideLabels").node().checked),C(d3.select("#disableTooltip").node().checked),v([n.x,n.y,2*n.r+I]);var r=window.location.href,a=r.substring(0,r.lastIndexOf("/"))+"/"+e+location.search;V=n.name+" | "+V,d(a)})}