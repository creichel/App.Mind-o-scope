function buildMindmap(e,t){"use strict";function n(){return window.innerWidth>window.innerHeight?window.innerHeight-50:window.innerWidth}function l(e){var t=0;return e.children&&e.children.forEach(function(e){var n=l(e);n>t&&(t=n)}),1+t}function i(e){if(e.children){for(var t=0;t<e.children.length;t++){var n=e.children[t];i(n)}1===e.children.length&&e.children.push({name:"===placeholder===",children:[{name:"===placeholder===",children:[]}]})}}function s(e){for(var t=e.length-1;t>=0;t--){var n=e[t];"===placeholder==="===n.name?e.splice(t,1):n.children&&s(n.children)}}function o(e){for(var t=0;t<e.length;t++){var n=e[t];if(n.children&&1===n.children.length){var l=n.x-n.children[0].x;n.children[0].x+=l,c(n.children[0],l)}}}function c(e,t){if(e.children)for(var n=0;n<e.children.length;n++)e.children[n].x+=t,c(e.children[n],t)}function r(e){for(var t=e[0].x,n=e[0].y,l=0;l<e.length;l++){var i=e[l];i.x-=t,i.y-=n}}function d(e,t){var n=window.location.href;if(n.indexOf(e+"=")>=0){var l=n.substring(0,n.indexOf(e)),i=n.substring(n.indexOf(e));i=i.substring(i.indexOf("=")+1),i=i.indexOf("&")>=0?i.substring(i.indexOf("&")):"",n=l+e+"="+t+i}else n+=n.indexOf("?")<0?"?"+e+"="+t:"&"+e+"="+t;a(n)}function a(e){history.pushState("",le,e),document.getElementById("shareURL").value=e.split("?")[0],document.title=le}function u(e){var t=new XMLHttpRequest;t.onreadystatechange=function(){4==t.readyState&&200==t.status&&(document.getElementById("A1").innerHTML=t.status,document.getElementById("A2").innerHTML=t.statusText,document.getElementById("A3").innerHTML=t.responseText)},t.open("post",e,!0),t.send()}function f(e){var t=0;return ze.selectAll("circle").data(e).enter().append("circle").attr("class",function(e){var t=_+(e.parent?e.children?"":" "+ee:" "+te);return t+=e.depth%2===0?" "+Q:" "+Y}).attr("r",function(e){return e.r+7}).style("fill",function(e){if(1===e.depth&&t++,e.children||1===e.depth){if(e.depth%2===0)return Oe(t);var n=d3.hsl(Oe(t)),l=d3.hsl("hsl("+n.h+","+100*n.s*1.09+"%,"+100*n.l*1.2+"%)");return l}return null})}function h(e,t){return ze.selectAll("g.label").data(e).enter().append("g").attr("class","label").style("opacity",function(e){return e.parent===t?1:0}).style("display",function(e){return e.parent===t?"inline":"none"}).attr("transform","translate(0,"+Ae+")").append("foreignObject").attr("width",120).attr("x",-60).attr("height",200).attr("y",-100).append("xhtml:div").classed("labelContainer",!0).html(function(e){return"<div><span>"+e.name+"</span></div>"})}function p(e){var t=12,n=0,l=d3.layout.tree(),i=ve.append("ul"),s=l.nodes(e),o=i.selectAll("li."+ne).data(s),c=o.enter().append("li").attr("class",function(e){var t=ne+(e.parent?e.children?"":" "+ee:" "+te);return t+=e.depth%2===0?" "+Q:" "+Y}).style("opacity",1).style("background-color",function(e){return Re(e.depth)}).append("span").attr("class","value").style("padding-left",function(e){return 30+e.depth*t+"px"}).html(function(e){return e.name}),r=i.selectAll("li."+ne).filter(function(e,t){return 0===t}).node().getBoundingClientRect().top;s.forEach(function(e,l){var s=i.selectAll("li."+ne).filter(function(e,t){return t===l}).node().getBoundingClientRect().top;e.x=s-r,e.y=e.depth*t,1===e.depth&&n++,e.value=n}),c.append("span").attr("class",function(e){return"point"+(e.parent?e.children?"":" "+ee:" "+te)}).style("padding-left",function(e){return e.depth*t+"px"}).style("color",function(e){var t=d3.hsl(Oe(e.value)),n=d3.hsl("hsl("+t.h+","+100*t.s*1.09+"%,"+100*t.l*1.2+"%)");return n});var d=ve.node().getBoundingClientRect().width,a=ve.node().getBoundingClientRect().height,u={top:16,right:10,bottom:10,left:14},f=d3.svg.line().x(function(e){return e.x}).y(function(e){return e.y}).interpolate("step-before");return ve.append("svg").attr("width",d-u.left-u.right+"px").attr("height",a+"px").append("g").attr("transform","translate("+u.left+","+u.top+")").selectAll("path.link").data(l.links(s)).enter().insert("path",":first-child").attr("class","link").attr("stroke",function(e){var t=d3.hsl(Oe(e.target.value)),n=d3.hsl("hsl("+t.h+","+100*t.s*1.09+"%,"+100*t.l*1.2+"%)");return n}).attr("d",function(e){return f([{y:e.source.x,x:e.source.y},{y:e.target.x,x:e.target.y}])}),o}function g(e){var n=Fe;if(Fe=e,T(e),Fe!==n){null==e.parent?ae.attr("disabled","true"):ae.attr("disabled",null);var l=d3.transition().duration(d3.event.altKey?10*t:t).tween("zoom",function(){var e=d3.interpolateZoom(Ie,[Fe.x,Fe.y,2*Fe.r]);return function(t){v(e(t))}});l.selectAll("g.label").filter(function(e){return e.parent===Fe||"inline"===this.style.display}).style("opacity",function(e){return e.parent===Fe?1:0}).each("start",function(e){e.parent===Fe&&(this.style.display="inline")}).each("end",function(e){e.parent!==Fe&&(this.style.display="none")})}}function v(e){var t=De/e[2];Ie=e,We.classed(Z,!1).filter(function(e){return Fe===e}).classed(Z,!0),je.classed(Z,!1).filter(function(e){return Fe===e}).classed(Z,!0),je.attr("transform",function(n){return"translate("+(n.x-e[0])*t+","+(n.y-e[1])*t+")"}),Se.attr("r",function(e){return e.r*t})}function y(){fe.classed(J,!fe.classed(J)),Me===!1?(M(),de.classed("active",!0),Me=!0,setTimeout(function(){ge.node().focus()},300)):(de.classed("active",!1),Me=!1,w(),ge.node().blur())}function m(){de.classed("active",!1),fe.classed(J,!1),Me=!1,ge.node().blur(),w()}function x(){he.classed(J,!he.classed(J)),pe.classed(Z,!pe.classed(Z)),fe.classed("visibleSettings",!fe.classed("visibleSettings"))}function w(){he.classed(J,!1),pe.classed(Z,!1)}function b(e){w(),We.classed(N,!0).filter(function(t){var n=t.name;return n.toLowerCase().indexOf(e.toLowerCase())>-1}).classed(N,!1),je.classed(N,!0).filter(function(t){var n=t.name;return n.toLowerCase().indexOf(e.toLowerCase())>-1}).classed(N,!1),""!==e?(ve.select("svg").style("display","none"),ue.text(e).classed(J,!0).on("click",function(){ue.classed(J,!1),document.getElementById("search").value="",We.classed(N,!1),je.classed(N,!1),ve.select("svg").style("display",null)})):(ue.classed(J,!1),ve.select("svg").style("display",null))}function k(e){d("zoom",e),t=e}function C(e){d("visited",e?"y":""),d3.select("body").classed("hide-visited",e)}function E(e){d("labels",e?"y":""),d3.select("body").classed("hide-labels",e)}function A(e){d("tooltips",e?"y":""),d3.select("body").classed("hide-tooltip",e)}function B(){window.location="download.php?hash="+e}function D(){R()}function O(){u("delete.php?hash="+e),R()}function R(){oe.classed("hover",!1).classed("error",!1).classed("dropped",!1).classed("success",!1).classed("dz-processing",!1).classed("dz-complete",!1),d3.select("body").style("position","relative"),se.style("display","block"),ce.style("display","none"),re.select("svg").remove(),ve.select("ul").remove(),ve.select("svg").remove(),ge.value="",ue.classed(J,!1),m(),w()}function L(e){d3.select(window).on("resize",function(){z(),M()}),d3.select("#"+P).on("click",function(){g(e),m()}),ae.on("click",function(){g(e)});var t;Se.on("click",function(e){Te.attr("class","d3-tip"),Te.hide(e),d3.select(this).classed(G,!0),Fe!==e?(m(),g(e),d3.event.stopPropagation()):null!=e.parent&&(g(e.parent),d3.event.stopPropagation())}).on("mouseover",function(e){Te.show(e),t=setTimeout(function(){Te.attr("class","d3-tip show")},300)}).on("mouseout",function(e){clearTimeout(t),Te.attr("class","d3-tip"),Te.hide(e)}),de.on("click",function(){y()}),We.on("click",function(e){e.children?Fe!==e&&(g(e),d3.event.stopPropagation()):Fe!==e.parent&&(g(e.parent),d3.event.stopPropagation())}).on("mouseover",function(e,t){je.filter(function(e,n){return t===n}).classed(X,!0)}).on("mouseout",function(e,t){je.filter(function(e,n){return t===n}).classed(X,!1)}),pe.on("click",function(){x()}),ge.on("input",function(){g(e),b(this.value)}),d3.selectAll("input").on("focus",function(){d3.event.preventDefault()}),ye.on("change",function(){C(this.checked)}),me.on("change",function(){E(this.checked)}),xe.on("change",function(){A(this.checked)}),we.on("mousedown",function(){d3.select("#zoomDurationOutput").classed("active",!0)}).on("mouseout",function(){d3.select("#zoomDurationOutput").classed("active",!1)}).on("change",function(){k(this.value)}),be.on("click",function(){B()}),ke.on("click",function(){D()}),Ce.on("click",function(){O()}),d3.select("body").on("keydown",function(){Me||70!=d3.event.keyCode?27==d3.event.keyCode&&(d3.event.preventDefault(),y()):(d3.event.preventDefault(),y())})}function z(){d3.select("body").style("position","relative"),Ee=document.getElementById(P).offsetWidth,Ae=document.getElementById(P).offsetHeight,De=n(),d3.select("#"+P).select("svg").style("width",Ee+"px").style("height",Ae+"px"),d3.select(self.frameElement).style("height",De+"px"),d3.select("#"+P).select("svg").select("g").attr("transform","translate("+Ee/2+","+(Ae/2+H/2)+")"),d3.select("body").style("position","fixed"),M()}function T(e){function t(e,n){if(null!=e.parent){e=e.parent,n.insert("span",":first-child").attr("class","divider");var l=e.depth+2>Fe.depth||e.depth<2?e.name:"···";n.insert("button",":first-child").text(l).on("click",function(){m(),g(e)}).on("mouseover",function(){"···"===l&&d3.select(this).classed("show-tip",!0),Se.filter(function(t){return e===t}).classed(X,!0)}).on("mouseout",function(){"···"===l&&d3.select(this).classed("show-tip",!1),Se.filter(function(t){return e===t}).classed(X,!1)}).append("span").text(e.name).classed("path-tip",!0).attr("style",function(){return"margin-left: -"+d3.select(this).node().getBoundingClientRect().width/2+"px"}),t(e,n)}}var n=d3.select("#path .content");n.html(""),n.append("span").attr("class",Z).text(e.name),t(e,n)}function M(){var e=Ae-fe.select("header").node().getBoundingClientRect().height-fe.select(".searchbar").node().getBoundingClientRect().height-fe.select("footer").node().getBoundingClientRect().height;fe.select(".content").style("height",e+"px"),fe.select(".scrollmask").style("height",e+"px")}function F(t){d3.json(t,function(t,n){if(t)throw t;z(),T(n),We=p(n),i(n),Fe=n,He=Le.nodes(n),console.log("Depth of the Mind Map: "+l(n)),Re.domain([0,l(n)]),s(He),o(He),r(He),console.log("Structure:"),console.log(n),Se=f(He),Pe=h(He,n),L(n),je=ze.selectAll("circle,g.label"),v([n.x,n.y,2*n.r+H]),C(d3.select("#hideVisited").node().checked),E(d3.select("#hideLabels").node().checked),A(d3.select("#disableTooltip").node().checked);var c=window.location.href,d=c.substring(0,c.lastIndexOf("/"))+"/"+e+location.search;le=n.name+" | "+le,a(d)})}var H=35,I=1,S=1e3,P="content",W="#sidebar",j="#menubutton",V="#toRoot",q="#treelist",K="#settings",U="#openSettings",X="hover",Z="active",G="visited",J="show",N="hide",Q="even",Y="odd",_="node",ee="leaf",te="root",ne="item",le="Mind-o-scope",ie="content/",se=d3.select("#upload"),oe=d3.select(".dropzone"),ce=d3.select("#mindmap"),re=d3.select("#"+P),de=d3.select(j),ae=d3.select(V),ue=d3.select("#searchterm"),fe=d3.select(W),he=fe.select(K),pe=fe.select(U),ge=fe.select("#search"),ve=fe.select(q),ye=d3.select("#hideVisited"),me=d3.select("#hideLabels"),xe=d3.select("#disableTooltip"),we=d3.select("#zoomDuration"),be=d3.select("#download"),ke=d3.select("#new"),Ce=d3.select("#delete"),Ee=window.innerWidth,Ae=window.innerHeight,Be=ie+e+".json",De=n(),Oe=d3.scale.ordinal().range(["#EF721F","#4E9CEE","#36D63D","#DEC815","#E076E7","#75AE29","#E8A117","#39CD68","#A886F2","#C985D6","#CA8025","#ABA414","#F46841","#A0CB1C","#50AB46","#75CE2F","#8E94E8","#33B22E","#61D350","#E58222"]),Re=d3.scale.linear().domain([0,8]).range(["#FCFCFC","#D4D4D4"]).interpolate(d3.interpolateRgb),Le=d3.layout.pack().padding(I).size([De-H,De-H]).value(function(e){return S*Math.pow(1/e.depth,3)}),ze=re.append("svg").append("g"),Te=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(e){return e.name});ze.call(Te);var Me=!1,Fe,He,Ie,Se,Pe,We,je;se.style("display","none"),ce.style("display","block"),F(Be)}