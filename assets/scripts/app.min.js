function buildMindmap(e,t){"use strict";function n(){return window.innerWidth>window.innerHeight?window.innerHeight-50:window.innerWidth}function l(e){var t=0;return e.children&&e.children.forEach(function(e){var n=l(e);n>t&&(t=n)}),1+t}function i(e){if(e.children){for(var t=0;t<e.children.length;t++){var n=e.children[t];i(n)}1===e.children.length&&e.children.push({name:"===placeholder===",children:[{name:"===placeholder===",children:[]}]})}}function s(e){for(var t=e.length-1;t>=0;t--){var n=e[t];"===placeholder==="===n.name?e.splice(t,1):n.children&&s(n.children)}}function o(e){for(var t=0;t<e.length;t++){var n=e[t];if(n.children&&1===n.children.length){var l=n.x-n.children[0].x;n.children[0].x+=l,c(n.children[0],l)}}}function c(e,t){if(e.children)for(var n=0;n<e.children.length;n++)e.children[n].x+=t,c(e.children[n],t)}function r(e){for(var t=e[0].x,n=e[0].y,l=0;l<e.length;l++){var i=e[l];i.x-=t,i.y-=n}}function a(e,t){var n=window.location.href;if(n.indexOf(e+"=")>=0){var l=n.substring(0,n.indexOf(e)),i=n.substring(n.indexOf(e));i=i.substring(i.indexOf("=")+1),i=i.indexOf("&")>=0?i.substring(i.indexOf("&")):"",n=l+e+"="+t+i}else n+=n.indexOf("?")<0?"?"+e+"="+t:"&"+e+"="+t;d(n,ie)}function d(e,t){history.pushState("",t,e),document.getElementById("shareURL").value=e.split("?")[0],document.title=t}function u(e){var t=new XMLHttpRequest;t.onreadystatechange=function(){4==t.readyState&&200==t.status&&(document.getElementById("A1").innerHTML=t.status,document.getElementById("A2").innerHTML=t.statusText,document.getElementById("A3").innerHTML=t.responseText)},t.open("post",e,!0),t.send()}function f(e){var t=0;return Te.selectAll("circle").data(e).enter().append("circle").attr("class",function(e){var t=_+(e.parent?e.children?"":" "+ee:" "+te);return t+=e.depth%2===0?" "+Q:" "+Y}).attr("r",function(e){return e.r}).style("fill",function(e){if(1===e.depth&&t++,e.children||1===e.depth){if(e.depth%2===0)return Re(t);var n=d3.hsl(Re(t)),l=d3.hsl("hsl("+n.h+","+100*n.s*1.09+"%,"+100*n.l*1.2+"%)");return l}return null})}function h(e,t){return Te.selectAll("g.label").data(e).enter().append("g").attr("class","label").style("opacity",function(e){return e.parent===t?1:0}).style("display",function(e){return e.parent===t?"inline":"none"}).attr("transform","translate(0,"+Be+")").append("foreignObject").attr("width",120).attr("x",-60).attr("height",200).attr("y",-100).append("xhtml:div").classed("labelContainer",!0).html(function(e){return"<div><span>"+e.name+"</span></div>"})}function p(e){var t=12,n=0,l=d3.layout.tree(),i=ye.append("ul"),s=l.nodes(e),o=i.selectAll("li."+ne).data(s),c=o.enter().append("li").attr("class",function(e){var t=ne+(e.parent?e.children?"":" "+ee:" "+te);return t+=e.depth%2===0?" "+Q:" "+Y}).style("opacity",1).style("background-color",function(e){return Le(e.depth)}).append("span").attr("class","value").style("padding-left",function(e){return 30+e.depth*t+"px"}).html(function(e){return e.name}),r=i.selectAll("li."+ne).filter(function(e,t){return 0===t}).node().getBoundingClientRect().top;s.forEach(function(e,l){var s=i.selectAll("li."+ne).filter(function(e,t){return t===l}).node().getBoundingClientRect().top;e.x=s-r,e.y=e.depth*t,1===e.depth&&n++,e.value=n}),c.append("span").attr("class",function(e){return"point"+(e.parent?e.children?"":" "+ee:" "+te)}).style("padding-left",function(e){return e.depth*t+"px"}).style("color",function(e){var t=d3.hsl(Re(e.value)),n=d3.hsl("hsl("+t.h+","+100*t.s*1.09+"%,"+100*t.l*1.2+"%)");return n});var a=ye.node().getBoundingClientRect().width,d=ye.node().getBoundingClientRect().height,u={top:16,right:10,bottom:10,left:14},f=d3.svg.line().x(function(e){return e.x}).y(function(e){return e.y}).interpolate("step-before");return ye.append("svg").attr("width",a-u.left-u.right+"px").attr("height",d+"px").append("g").attr("transform","translate("+u.left+","+u.top+")").selectAll("path.link").data(l.links(s)).enter().insert("path",":first-child").attr("class","link").attr("stroke",function(e){var t=d3.hsl(Re(e.target.value)),n=d3.hsl("hsl("+t.h+","+100*t.s*1.09+"%,"+100*t.l*1.2+"%)");return n}).attr("d",function(e){return f([{y:e.source.x,x:e.source.y},{y:e.target.x,x:e.target.y}])}),o}function v(e){var n=Fe;if(Fe=e,T(e),Fe!==n){null==e.parent?ue.attr("disabled","true"):ue.attr("disabled",null);var l=d3.transition().duration(d3.event.altKey?10*t:t).tween("zoom",function(){var e=d3.interpolateZoom(Se,[Fe.x,Fe.y,2*Fe.r]);return function(t){g(e(t))}});l.selectAll("g.label").filter(function(e){return e.parent===Fe||"inline"===this.style.display}).style("opacity",function(e){return e.parent===Fe?1:0}).each("start",function(e){e.parent===Fe&&(this.style.display="inline")}).each("end",function(e){e.parent!==Fe&&(this.style.display="none")})}}function g(e){var t=Oe/e[2];Se=e,je.classed(Z,!1).filter(function(e){return Fe===e}).classed(Z,!0),Ve.classed(Z,!1).filter(function(e){return Fe===e}).classed(Z,!0),Ve.attr("transform",function(n){return"translate("+(n.x-e[0])*t+","+(n.y-e[1])*t+")"}),Pe.attr("r",function(e){return e.r*t})}function y(){he.classed(J,!he.classed(J)),Me===!1?(I(),de.classed("active",!0),Me=!0,setTimeout(function(){ge.node().focus()},300)):(de.classed("active",!1),Me=!1,w(),ge.node().blur())}function m(){de.classed("active",!1),he.classed(J,!1),Me=!1,ge.node().blur(),w()}function x(){pe.classed(J,!pe.classed(J)),ve.classed(Z,!ve.classed(Z)),he.classed("visibleSettings",!he.classed("visibleSettings"))}function w(){pe.classed(J,!1),ve.classed(Z,!1)}function b(e){w(),je.classed(N,!0).filter(function(t){var n=t.name;return n.toLowerCase().indexOf(e.toLowerCase())>-1}).classed(N,!1),Ve.classed(N,!0).filter(function(t){var n=t.name;return n.toLowerCase().indexOf(e.toLowerCase())>-1}).classed(N,!1),""!==e?(ye.select("svg").style("display","none"),fe.text(e).classed(J,!0).on("click",function(){fe.classed(J,!1),document.getElementById("search").value="",je.classed(N,!1),Ve.classed(N,!1),ye.select("svg").style("display",null)})):(fe.classed(J,!1),ye.select("svg").style("display",null))}function k(e){a("zoom",e),t=e}function C(e){a("visited",e?"y":""),d3.select("body").classed("hide-visited",e)}function E(e){a("labels",e?"y":""),d3.select("body").classed("hide-labels",e)}function A(e){a("tooltips",e?"y":""),d3.select("body").classed("hide-tooltip",e)}function B(){window.location="download.php?hash="+e}function D(){R()}function O(){u("delete.php?hash="+e),R()}function R(){ce.classed("hover",!1).classed("error",!1).classed("dropped",!1).classed("success",!1).classed("dz-processing",!1).classed("dz-complete",!1),d3.select("body").style("position","relative"),oe.style("display","block"),re.style("display","none"),ae.select("svg").remove(),ye.select("ul").remove(),ye.select("svg").remove(),d3.select("#path .content").html(""),ge.value="",fe.classed(J,!1);var e=window.location.href,t=e.substring(0,e.lastIndexOf("/"));d(t,le),m(),w()}function L(e){d3.select(window).on("resize",function(){z(),I()}),d3.select("#"+P).on("click",function(){v(e),m()}),ue.on("click",function(){v(e)});var t;Pe.on("click",function(e){Ie.attr("class","d3-tip"),Ie.hide(e),d3.select(this).classed(G,!0),Fe!==e?(m(),v(e),d3.event.stopPropagation()):null!=e.parent&&(v(e.parent),d3.event.stopPropagation())}).on("mouseover",function(e){Ie.show(e),t=setTimeout(function(){Ie.attr("class","d3-tip show")},300)}).on("mouseout",function(e){clearTimeout(t),Ie.attr("class","d3-tip"),Ie.hide(e)}),de.on("click",function(){y()}),je.on("click",function(e){e.children?Fe!==e&&(v(e),d3.event.stopPropagation()):Fe!==e.parent&&(v(e.parent),d3.event.stopPropagation())}).on("mouseover",function(e,t){Ve.filter(function(e,n){return t===n}).classed(X,!0)}).on("mouseout",function(e,t){Ve.filter(function(e,n){return t===n}).classed(X,!1)}),ve.on("click",function(){x()}),ge.on("input",function(){v(e),b(this.value)}),d3.selectAll("input").on("focus",function(){d3.event.preventDefault()}),me.on("change",function(){C(this.checked)}),xe.on("change",function(){E(this.checked)}),we.on("change",function(){A(this.checked)}),be.on("mousedown",function(){d3.select("#zoomDurationOutput").classed("active",!0)}).on("mouseout",function(){d3.select("#zoomDurationOutput").classed("active",!1)}).on("change",function(){k(this.value)}),ke.on("click",function(){B()}),Ce.on("click",function(){D()}),Ee.on("click",function(){O()}),d3.select("body").on("keydown",function(){Me||70!=d3.event.keyCode?27==d3.event.keyCode&&(d3.event.preventDefault(),y()):(d3.event.preventDefault(),y())})}function z(){d3.select("body").style("position","relative"),Ae=document.getElementById(P).offsetWidth,Be=document.getElementById(P).offsetHeight,Oe=n(),d3.select("#"+P).select("svg").style("width",Ae+"px").style("height",Be+"px").select("g").attr("transform","translate("+Ae/2+","+(Be/2+F/2)+")"),d3.select(self.frameElement).style("height",Oe+"px"),d3.select("body").style("position","fixed"),I()}function T(e){function t(e,n){if(null!=e.parent){e=e.parent,n.insert("span",":first-child").attr("class","divider");var l=e.depth+2>Fe.depth||e.depth<2?e.name:"···";n.insert("button",":first-child").text(l).on("click",function(){m(),v(e)}).on("mouseover",function(){"···"===l&&d3.select(this).classed("show-tip",!0),Pe.filter(function(t){return e===t}).classed(X,!0)}).on("mouseout",function(){"···"===l&&d3.select(this).classed("show-tip",!1),Pe.filter(function(t){return e===t}).classed(X,!1)}).append("span").text(e.name).classed("path-tip",!0).attr("style",function(){return"margin-left: -"+d3.select(this).node().getBoundingClientRect().width/2+"px"}),t(e,n)}}var n=d3.select("#path .content");n.html(""),n.append("span").attr("class",Z).text(e.name),t(e,n)}function I(){var e=Be-he.select("header").node().getBoundingClientRect().height-he.select(".searchbar").node().getBoundingClientRect().height-he.select("footer").node().getBoundingClientRect().height;he.select(".content").style("height",e+"px"),he.select(".scrollmask").style("height",e+"px")}function M(t){d3.json(t,function(t,n){if(t)throw t;z(),T(n),je=p(n),i(n),Fe=n,He=ze.nodes(n),console.log("Depth of the Mind Map: "+l(n)),Le.domain([0,l(n)]),s(He),o(He),console.log("Structure:"),console.log(n),Pe=f(He),We=h(He,n),L(n),Ve=Te.selectAll("circle,g.label"),g([n.x,n.y,2*n.r+F]),C(d3.select("#hideVisited").node().checked),E(d3.select("#hideLabels").node().checked),A(d3.select("#disableTooltip").node().checked);var c=window.location.href,r=c.substring(0,c.lastIndexOf("/"))+"/"+e+location.search;ie=n.name+" | "+le,d(r,ie)})}var F=35,H=1.5,S=3,P="content",W="#sidebar",j="#menubutton",V="#toRoot",q="#treelist",K="#settings",U="#openSettings",X="hover",Z="active",G="visited",J="show",N="hide",Q="even",Y="odd",_="node",ee="leaf",te="root",ne="item",le="Mind-o-scope",ie,se="uploaded/",oe=d3.select("#upload"),ce=d3.select(".dropzone"),re=d3.select("#mindmap"),ae=d3.select("#"+P),de=d3.select(j),ue=d3.select(V),fe=d3.select("#searchterm"),he=d3.select(W),pe=he.select(K),ve=he.select(U),ge=he.select("#search"),ye=he.select(q),me=d3.select("#hideVisited"),xe=d3.select("#hideLabels"),we=d3.select("#disableTooltip"),be=d3.select("#zoomDuration"),ke=d3.select("#download"),Ce=d3.select("#new"),Ee=d3.select("#delete"),Ae=window.innerWidth,Be=window.innerHeight,De=se+e+".json",Oe=n(),Re=d3.scale.ordinal().range(["#EF721F","#4E9CEE","#36D63D","#DEC815","#E076E7","#75AE29","#E8A117","#39CD68","#A886F2","#C985D6","#CA8025","#ABA414","#F46841","#A0CB1C","#50AB46","#75CE2F","#8E94E8","#33B22E","#61D350","#E58222"]),Le=d3.scale.linear().domain([0,8]).range(["#FCFCFC","#D4D4D4"]).interpolate(d3.interpolateRgb),ze=d3.layout.pack().padding(H).size([Oe-F,Oe-F]).value(function(e){return Math.pow(1/e.depth,S)}).sort(function(e,t){return-(e.value-t.value)}),Te=ae.append("svg").append("g"),Ie=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(e){return e.name});Te.call(Ie);var Me=!1,Fe,He,Se,Pe,We,je,Ve;oe.style("display","none"),re.style("display","block"),M(De)}