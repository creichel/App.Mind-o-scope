function buildMindmap(e,t){"use strict";function n(){return window.innerWidth>window.innerHeight?window.innerHeight-50:window.innerWidth}function l(e){var t=0;return e.children&&e.children.forEach(function(e){var n=l(e);n>t&&(t=n)}),1+t}function i(e){if(e.children){for(var t=0;t<e.children.length;t++){var n=e.children[t];i(n)}1===e.children.length&&e.children.push({name:"placeholder",children:[{name:"placeholder",children:[]}]})}}function s(e){for(var t=e.length-1;t>=0;t--){var n=e[t];"placeholder"===n.name?e.splice(t,1):n.children&&s(n.children)}}function o(e){function t(e,n){if(e.children)for(var l=0;l<e.children.length;l++)e.children[l].x+=n,t(e.children[l],n)}for(var n=0;n<e.length;n++){var l=e[n];if(l.children&&1===l.children.length){var i=l.x-l.children[0].x;l.children[0].x+=i,t(l.children[0],i)}}}function c(e){for(var t=e[0].x,n=e[0].y,l=0;l<e.length;l++){var i=e[l];i.x-=t,i.y-=n}}function r(e,t){var n=window.location.href;if(n.indexOf(e+"=")>=0){var l=n.substring(0,n.indexOf(e)),i=n.substring(n.indexOf(e));i=i.substring(i.indexOf("=")+1),i=i.indexOf("&")>=0?i.substring(i.indexOf("&")):"",n=l+e+"="+t+i}else n+=n.indexOf("?")<0?"?"+e+"="+t:"&"+e+"="+t;a(n)}function a(e){history.pushState("",le,e),document.getElementById("shareURL").value=e.split("?")[0],document.title=le}function d(e){var t=new XMLHttpRequest;t.onreadystatechange=function(){4==t.readyState&&200==t.status&&(document.getElementById("A1").innerHTML=t.status,document.getElementById("A2").innerHTML=t.statusText,document.getElementById("A3").innerHTML=t.responseText)},t.open("post",e,!0),t.send()}function u(e){var t=0;return Te.selectAll("circle").data(e).enter().append("circle").attr("class",function(e){var t=_+(e.parent?e.children?"":" "+ee:" "+te);return t+=e.depth%2===0?" "+Q:" "+Y}).attr("r",function(e){return e.r+7}).style("fill",function(e){if(1===e.depth&&t++,e.children){if(e.depth%2!==0)return Me(t);var n=d3.hsl(Me(t)),l=d3.hsl("hsl("+n.h+","+100*n.s*1.09+"%,"+100*n.l*1.2+"%)");return l}return null})}function f(e,t){var n=Te.selectAll("g.label").data(e).enter().append("g").attr("class","label").attr("transform","translate(0,"+Re+")");return n.style("opacity",function(e){return e.parent===t?1:0}).style("display",function(e){return e.parent===t?"inline":"none"}).append("foreignObject").attr("width",120).attr("x",-60).attr("height",200).attr("y",-100).append("xhtml:div").classed("labelContainer",!0).html(function(e){return"<div><span>"+e.name+"</span></div>"}),n}function h(e){function t(e){var t=15,n=0,l=d3.layout.tree(),i=we.append("ul"),s=l.nodes(e),o=i.selectAll("li."+ne).data(s),c=o.enter().append("li").attr("class",function(e){var t=ne+(e.parent?e.children?"":" "+ee:" "+te);return t+=e.depth%2===0?" "+Q:" "+Y}).style("opacity",1).style("background-color",function(e){return Fe(e.depth)}).append("span").attr("class","value").style("padding-left",function(e){return 30+e.depth*t+"px"}).html(function(e){return e.name}),r=i.selectAll("li."+ne).filter(function(e,t){return 0==t}).node().getBoundingClientRect().top;s.forEach(function(e,l){var s=i.selectAll("li."+ne).filter(function(e,t){return t==l}).node().getBoundingClientRect().top;e.x=s-r,e.y=e.depth*t,1==e.depth&&n++,e.value=n}),c.append("span").attr("class","point").style("padding-left",function(e){return e.depth*t+"px"}).style("color",function(e){return Me(e.value)});var a=we.node().getBoundingClientRect().width,d=we.node().getBoundingClientRect().height,u={top:17,right:10,bottom:10,left:15},f=d3.svg.line().x(function(e){return e.x}).y(function(e){return e.y}).interpolate("step"),h=we.append("svg").attr("width",a-u.left-u.right+"px").attr("height",d+"px").append("g").attr("transform","translate("+u.left+","+u.top+")"),p=h.selectAll("path.link").data(l.links(s)).enter().insert("path",":first-child").attr("class","link").attr("stroke",function(e){return Me(e.target.value)}).attr("d",function(e){return f([{y:e.source.x,x:e.source.y},{y:e.target.x,x:e.target.y}])});return o}return t(e)}function p(e){var n=We;if(We=e,z(e),We!==n){null==e.parent?de.attr("disabled","true"):de.attr("disabled",null);var l=d3.transition().duration(d3.event.altKey?10*t:t).tween("zoom",function(){var e=d3.interpolateZoom(Ve,[We.x,We.y,2*We.r]);return function(t){g(e(t))}});l.selectAll("g.label").filter(function(e){return e.parent===We||"inline"===this.style.display}).style("opacity",function(e){return e.parent===We?1:0}).each("start",function(e){e.parent===We&&(this.style.display="inline")}).each("end",function(e){e.parent!==We&&(this.style.display="none")})}}function g(e){Ue.classed(X,!1).filter(function(e){return We==e}).classed(X,!0),Xe.classed(X,!1).filter(function(e){return We==e}).classed(X,!0);var t=Ie/e[2];Ve=e,Xe.attr("transform",function(n){return"translate("+(n.x-e[0])*t+","+(n.y-e[1])*t+")"}),qe.attr("r",function(e){return e.r*t})}function v(){fe.classed(J,!fe.classed(J)),0==Pe?(I(),Pe=!0,setTimeout(function(){me.node().focus()},300)):(Pe=!1,b(),me.node().blur())}function y(){fe.classed(J,!1),Pe=!1,me.node().blur(),b()}function m(){he.classed(J,!he.classed(J)),pe.classed(X,!pe.classed(X)),fe.classed("visibleSettings",!fe.classed("visibleSettings"))}function b(){he.classed(J,!1),pe.classed(X,!1)}function x(e){b(),Ue.classed(N,!0).filter(function(t){var n=t.name;return n.toLowerCase().indexOf(e.toLowerCase())>-1}).classed(N,!1),Xe.classed(N,!0).filter(function(t){var n=t.name;return n.toLowerCase().indexOf(e.toLowerCase())>-1}).classed(N,!1),""!=e?(we.select("svg").style("display","none"),ue.text(e).classed(J,!0).on("click",function(){ue.classed(J,!1),document.getElementById("search").value="",Ue.classed(N,!1),Xe.classed(N,!1),we.select("svg").style("display",null)})):(ue.classed(J,!1),we.select("svg").style("display",null))}function w(e){r("zoom",e),t=e}function k(e){r("visited",e?"y":""),d3.select("body").classed("hide-visited",e)}function C(e){r("labels",e?"y":""),d3.select("body").classed("hide-labels",e)}function E(e){r("tooltips",e?"y":""),d3.select("body").classed("hide-tooltip",e)}function A(){window.location="download.php?hash="+e}function B(){O()}function D(){d("delete.php?hash="+e),O()}function O(){oe.classed("hover",!1).classed("error",!1).classed("dropped",!1).classed("success",!1).classed("dz-processing",!1).classed("dz-complete",!1),d3.select("body").style("position","relative"),se.style("display","block"),ce.style("display","none"),re.select("svg").remove(),we.select("ul").remove(),we.select("svg").remove(),y(),b(),ue.classed(J,!1)}function L(e){d3.select(window).on("resize",function(){R(),I()}),d3.select("#"+S).on("click",function(){p(e),y()}),de.on("click",function(){p(e)}),qe.on("click",function(e){d3.select(this).classed(G,!0),We!==e?(y(),p(e),d3.event.stopPropagation()):null!=e.parent&&(p(e.parent),d3.event.stopPropagation())}).on("mouseover",function(e){Se.attr("class","d3-tip animate").show(e)}).on("mouseout",function(e){Se.attr("class","d3-tip").show(e),Se.hide()}),ae.on("click",function(){v()}),Ue.on("click",function(e){e.children?We!==e&&(p(e),d3.event.stopPropagation()):We!==e.parent&&(p(e.parent),d3.event.stopPropagation())}).on("mouseover",function(e,t){Xe.filter(function(e,n){return t==n}).classed(U,!0)}).on("mouseout",function(e,t){Xe.filter(function(e,n){return t==n}).classed(U,!1)}),pe.on("click",function(){m()}),me.on("input",function(){p(e);var t=this.value;x(t)}),d3.selectAll("input").on("focus",function(){d3.event.preventDefault()}),ke.on("change",function(){k(this.checked)}),Ce.on("change",function(){C(this.checked)}),Ee.on("change",function(){E(this.checked)}),Ae.on("mousedown",function(){d3.select("#zoomDurationOutput").classed("active",!0)}).on("mouseout",function(){d3.select("#zoomDurationOutput").classed("active",!1)}).on("change",function(){w(this.value)}),Be.on("click",function(){A()}),De.on("click",function(){B()}),Oe.on("click",function(){D()}),d3.select("body").on("keydown",function(){Pe||70!=d3.event.keyCode?27==d3.event.keyCode&&(d3.event.preventDefault(),v()):(d3.event.preventDefault(),v())})}function R(){d3.select("body").style("position","relative"),Le=document.getElementById(S).offsetWidth,Re=document.getElementById(S).offsetHeight,Ie=n(),d3.select("#"+S).select("svg").style("width",Le+"px").style("height",Re+"px"),d3.select(self.frameElement).style("height",Ie+"px"),d3.select("#"+S).select("svg").select("g").attr("transform","translate("+Le/2+","+(Re/2+F/2)+")"),d3.select("body").style("position","fixed")}function z(e){function t(e,n){if(null!=e.parent){e=e.parent,n.insert("span",":first-child").attr("class","divider");var l=e.depth+2>We.depth||e.depth<2?e.name:"···";n.insert("button",":first-child").text(l).on("click",function(){y(),p(e)}).on("mouseover",function(){qe.filter(function(t){return e==t}).classed(U,!0)}).on("mouseout",function(){qe.filter(function(t){return e==t}).classed(U,!1)}),t(e,n)}}var n=d3.select("#path .content");n.html(""),n.append("span").attr("class",X).text(e.name),t(e,n)}function I(){var e=Re-fe.select("header").node().getBoundingClientRect().height-fe.select(".searchbar").node().getBoundingClientRect().height-fe.select("footer").node().getBoundingClientRect().height;fe.select(".content").style("height",e+"px"),fe.select(".scrollmask").style("height",e+"px")}function M(t){d3.json(t,function(t,n){if(t)throw t;z(n),R(),I(),Ue=h(n),i(n),We=n,je=He.nodes(n),console.log("Depth of the Mind Map: "+l(n)),Fe.domain([0,l(n)]),s(je),o(je),c(je),console.log("Structure:"),console.log(n),qe=u(je),Ke=f(je,n),L(n),Xe=Te.selectAll("circle,g.label"),k(d3.select("#hideVisited").node().checked),C(d3.select("#hideLabels").node().checked),E(d3.select("#disableTooltip").node().checked),g([n.x,n.y,2*n.r+F]);var r=window.location.href,d=r.substring(0,r.lastIndexOf("/"))+"/"+e+location.search;le=n.name+" | "+le,a(d)})}var F=35,H=1,T=1e3,S="content",P="#sidebar",W="#menubutton",j="#toRoot",V="#treelist",q="#settings",K="#openSettings",U="hover",X="active",Z="selected",G="visited",J="show",N="hide",Q="even",Y="odd",_="node",ee="leaf",te="root",ne="item",le="Mind-o-scope",ie="content/",se=d3.select("#upload"),oe=d3.select(".dropzone"),ce=d3.select("#mindmap"),re=d3.select("#"+S),ae=d3.select(menubutton),de=d3.select(j),ue=d3.select("#searchterm"),fe=d3.select(P),he=fe.select(q),pe=fe.select(K),ge=fe.select(".content"),ve=fe.select(".scrollmask"),ye=fe.select(".searchbar"),me=fe.select("#search"),be=fe.select("header"),xe=fe.select("footer"),we=fe.select(V),ke=d3.select("#hideVisited"),Ce=d3.select("#hideLabels"),Ee=d3.select("#disableTooltip"),Ae=d3.select("#zoomDuration"),Be=d3.select("#download"),De=d3.select("#new"),Oe=d3.select("#delete"),Le=window.innerWidth,Re=window.innerHeight,ze=ie+e+".json",Ie=n(),Me=d3.scale.ordinal().range(["#EF721F","#4E9CEE","#36D63D","#DEC815","#E076E7","#75AE29","#E8A117","#39CD68","#A886F2","#C985D6","#CA8025","#ABA414","#F46841","#A0CB1C","#50AB46","#75CE2F","#8E94E8","#33B22E","#61D350","#E58222"]),Fe=d3.scale.linear().domain([0,8]).range(["#FCFCFC","#D4D4D4"]).interpolate(d3.interpolateRgb),He=d3.layout.pack().padding(H).size([Ie-F,Ie-F]).value(function(e){return T*Math.pow(1/e.depth,3)}),Te=re.append("svg").append("g"),Se=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(e){return e.name});Te.call(Se),String.prototype.trunc=function(e,t){var n=this.length>e,l=n?this.substr(0,e-1):this;return l=t&&n?l.substr(0,l.lastIndexOf(" ")):l,n?l+"…":l};var Pe=!1,We,je,Ve,qe,Ke,Ue,Xe;se.style("display","none"),ce.style("display","block"),M(ze)}