function getDiameter(){return window.innerWidth>window.innerHeight?window.innerHeight:window.innerWidth}function addPlaceholders(e){if(e.children){for(var t=0;t<e.children.length;t++){var n=e.children[t];addPlaceholders(n)}1===e.children.length&&e.children.push({name:"placeholder",children:[{name:"placeholder",children:[]}]})}}function removePlaceholders(e){for(var t=e.length-1;t>=0;t--){var n=e[t];"placeholder"===n.name?e.splice(t,1):n.children&&removePlaceholders(n.children)}}function centerNodes(e){function t(e,n){if(e.children)for(var i=0;i<e.children.length;i++)e.children[i].x+=n,t(e.children[i],n)}for(var n=0;n<e.length;n++){var i=e[n];if(i.children&&1===i.children.length){var r=i.x-i.children[0].x;i.children[0].x+=r,t(i.children[0],r)}}}function makePositionsRelativeToZero(e){for(var t=e[0].x,n=e[0].y,i=0;i<e.length;i++){var r=e[i];r.x-=t,r.y-=n}}function type(e){return e.value=+e.value,e}var margin=10,circlePadding=3,diameter=getDiameter(),container="content",$sidebar=d3.select("#sidebar"),$menubutton=d3.select("#menubutton"),$overviewButton=d3.select("#toRoot");dataFile=file,width=document.getElementById(container).offsetWidth,height=document.getElementById(container).offsetHeight,title="Mindmap",maxNodeSize=1e4;var color=d3.scale.category20(),colorgrey=d3.scale.linear().domain([0,6]).range(["#FCFCFC","#C4C4C4"]).interpolate(d3.interpolateRgb),isSidebarOpen=!1,pack=d3.layout.pack().padding(circlePadding).size([diameter-margin,diameter-margin]).value(function(e){return maxNodeSize*Math.pow(1/e.depth,3)}),svg=d3.select("#"+container).append("svg").append("g"),tip=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(e){return e.name});svg.call(tip),d3.json(dataFile,function(e,t){function n(e){var n=l;if(l=e,l!==n){e===t?$overviewButton.attr("disabled","true"):$overviewButton.attr("disabled",null);var r=d3.transition().duration(d3.event.altKey?7500:750).tween("zoom",function(e){var t=d3.interpolateZoom(c,[l.x,l.y,2*l.r+margin]);return function(e){i(t(e))}});r.selectAll("text").filter(function(e){return e.parent===l||"inline"===this.style.display}).style("fill-opacity",function(e){return e.parent===l?1:0}).each("start",function(e){e.parent===l&&(this.style.display="inline")}).each("end",function(e){e.parent!==l&&(this.style.display="none")})}}function i(e){f.classed("active",!1).filter(function(e,t){return l==e}).classed("active",!0),u.classed("active",!1).filter(function(e,t){return l==e}).classed("active",!0);var t=diameter/e[2];c=e,p.attr("transform",function(n){return"translate("+(n.x-e[0])*t+","+(n.y-e[1])*t+")"}),u.attr("r",function(e){return e.r*t})}function r(){width=document.getElementById(container).offsetWidth,height=document.getElementById(container).offsetHeight,diameter=getDiameter(),d3.select("#"+container+" svg").style("width",width).style("height",height),d3.select(self.frameElement).style("height",diameter+"px"),d3.select("#"+container).select("svg").select("g").attr("transform","translate("+width/2+","+height/2+")")}function o(){$sidebar.classed("show",!$sidebar.classed("show")),0==isSidebarOpen?(isSidebarOpen=!0,setTimeout(function(){d3.select("#search").node().focus()},300)):(isSidebarOpen=!1,d3.select("#search").node().blur())}function a(){$sidebar.classed("show",!1),isSidebarOpen=!1,d3.select("#search").node().blur()}if(addPlaceholders(t),e)throw e;var l=t,d=pack.nodes(t),c;removePlaceholders(d),centerNodes(d),makePositionsRelativeToZero(d),console.log(t);var s=0,u=svg.selectAll("circle").data(d).enter().append("circle").attr("class",function(e){return output="node"+(e.parent?e.children?"":" leaf":" root"),output+=e.depth%2===0?" even":" odd",output}).attr("r",function(e){return e.r+7}).style("fill",function(e){return 1==e.depth&&s++,e.children?e.depth%2!=0?color(s):"rgba(255,255,255,0.35)":null}).on("click",function(e){a(),l!==e&&(n(e),d3.event.stopPropagation())}).on("mouseover",function(e){tip.attr("class","d3-tip animate").show(e)}).on("mouseout",function(e){tip.attr("class","d3-tip").show(e),tip.hide()}),h=svg.selectAll("text").data(d).enter().append("text").attr("class","label").style("fill-opacity",function(e){return e.parent===t?1:0}).style("display",function(e){return e.parent===t?null:"none"}).text(function(e){return 0===e.depth&&(console.log("found root name: "+e.name),title=e.name),e.name}),s=0,f=d3.select("#nodelist").selectAll("div").data(d).enter().append("div").text(function(e){return e.name}).attr("class",function(e){return output="listitem"+(e.parent?e.children?"":" leaf":" root"),output+=e.depth%2===0?" even":" odd",output}).style("background-color",function(e){return e.children?colorgrey(e.depth):"#f2f2f2"}).on("click",function(e){e.children?l!==e&&(n(e),d3.event.stopPropagation()):l!==e.parent&&(n(e.parent),d3.event.stopPropagation())}).on("mouseover",function(e,t){u.filter(function(e,n){return t==n}).classed("highlight",!0)}).on("mouseout",function(e,t){u.filter(function(e,n){return t==n}).classed("highlight",!1)}),p=svg.selectAll("circle,text");i([t.x,t.y,2*t.r+margin]),r(),d3.select("#"+container).on("click",function(){n(t)}),$overviewButton.on("click",function(){n(t)}),$menubutton.on("click",function(){o()}),d3.select("body").on("keydown",function(){isSidebarOpen||70!=d3.event.keyCode?27==d3.event.keyCode&&o():(d3.event.preventDefault(),o())}),d3.select("#search").on("input",function(){var e=this.value;n(t),f.classed("hide",!0).filter(function(t,n){var i=t.name;return i.toLowerCase().indexOf(e.toLowerCase())>-1}).classed("hide",!1),u.classed("hide",!0).filter(function(t,n){var i=t.name;return i.toLowerCase().indexOf(e.toLowerCase())>-1}).classed("hide",!1),h.classed("hide",!0).filter(function(t,n){var i=t.name;return i.toLowerCase().indexOf(e.toLowerCase())>-1}).classed("hide",!1)}),d3.select(window).on("resize",r)});